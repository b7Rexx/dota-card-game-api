{"version":3,"sources":["../../src/controllers/heroes.js"],"names":["fetchAll","req","res","next","heroRepository","getAll","then","data","json","catch","err","fetchById","getById","params","id","create","heroObj","name","body","hero_type_id","option","imageObj","hero_id","image","thumbnail","original","heroImageRepository","imgData","status","HttpStatus","CREATED","hero","update","getByWhere","result","model","length","Promise","models","forEach","item","index","removeImagebyId","remove","NO_CONTENT","paginate","query","page","pagesize"],"mappings":"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","sourcesContent":["import HttpStatus from 'http-status-codes';\n\nimport heroRepository from '../repositories/heroRepository';\nimport heroImageRepository from '../repositories/heroImageRepository';\n\n/**\n * Get all heros.\n *\n * @param {Object} req\n * @param {Object} res\n * @param {Function} next\n */\nexport function fetchAll(req, res, next) {\n  heroRepository\n    .getAll()\n    .then((data) => res.json({ data }))\n    .catch((err) => next(err));\n}\n\n/**\n * Get a hero by its id.\n *\n * @param {Object} req\n * @param {Object} res\n * @param {Function} next\n */\nexport function fetchById(req, res, next) {\n  heroRepository\n    .getById(req.params.id)\n    .then((data) => res.json({ data }))\n    .catch((err) => next(err));\n}\n\n/**\n * Create a new hero.\n *\n * @param {Object} req\n * @param {Object} res\n * @param {Function} next\n */\nexport function create(req, res, next) {\n  const heroObj = {\n    name: req.body.name,\n    hero_type_id: req.body.hero_type_id,\n  };\n\n  heroRepository\n    .create(heroObj)\n    .then((data) => {\n      // req.body.option {boolean} from multer funtion\n      if (req.body.option) {\n        const imageObj = {\n          hero_id: data.id,\n          image: req.body.image,\n          thumbnail: req.body.thumbnail,\n          original: req.body.original,\n        };\n\n        heroImageRepository\n          .create(imageObj)\n          .then((imgData) => res.status(HttpStatus.CREATED).json({ hero: data, image: imgData }));\n      } else res.status(HttpStatus.CREATED).json({ hero: data });\n    })\n    .catch((err) => next(err));\n}\n\n/**\n * Update a hero.\n *\n * @param {Object} req\n * @param {Object} res\n * @param {Function} next\n */\nexport function update(req, res, next) {\n  const heroObj = {\n    name: req.body.name,\n    hero_type_id: req.body.hero_type_id,\n  };\n\n  heroRepository\n    .update(req.params.id, heroObj)\n    .then((data) => {\n      if (req.body.option) {\n        heroImageRepository\n          .getByWhere({ hero_id: req.params.id })\n          .then((result) => {\n            if (result.model.length > 0) {\n              // remove hero images by user id\n              return new Promise((res) => {\n                result.model.models.forEach((item, index) => {\n                  heroImageRepository\n                    .removeImagebyId(item.id)\n                    .then(() => {\n                      if (index === result.model.length - 1) {\n                        res();\n                      }\n                    })\n                    .catch(() => {\n                      if (index === result.model.length - 1) {\n                        res();\n                      }\n                    });\n                });\n              });\n            }\n          })\n          .then(() => {\n            const imageObj = {\n              hero_id: data.id,\n              image: req.body.image,\n              thumbnail: req.body.thumbnail,\n              original: req.body.original,\n            };\n\n            heroImageRepository\n              .create(imageObj)\n              .then((imgData) => res.status(HttpStatus.CREATED).json({ hero: data, image: imgData }));\n          });\n      } else res.status(HttpStatus.CREATED).json({ hero: data });\n    })\n    .catch((err) => next(err));\n}\n\n/**\n * Delete a hero.\n *\n * @param {Object} req\n * @param {Object} res\n * @param {Function} next\n */\nexport function remove(req, res, next) {\n  heroImageRepository\n    .getByWhere({ hero_id: req.params.id })\n    .then((result) => {\n      if (result.model.length > 0) {\n        // remove hero images by user id\n        return new Promise((res) => {\n          result.model.models.forEach((item, index) => {\n            heroImageRepository\n              .removeImagebyId(item.id)\n              .then(() => {\n                if (index === result.model.length - 1) {\n                  res();\n                }\n              })\n              .catch(() => {\n                if (index === result.model.length - 1) {\n                  res();\n                }\n              });\n          });\n        });\n      }\n    })\n    .then(() => {\n      heroRepository\n        .remove(req.params.id)\n        .then((data) => res.status(HttpStatus.NO_CONTENT).json({ data }))\n        .catch((err) => next(err));\n    })\n    .catch((err) => next(err));\n}\n\n/**\n * Get Paginated heroes.\n *\n * @param {*} req\n * @param {*} res\n * @param {*} next\n */\nexport function paginate(req, res, next) {\n  heroRepository\n    .paginate(req.query.page, req.query.pagesize)\n    .then((data) => res.json({ data }))\n    .catch((err) => next(err));\n}\n"],"file":"heroes.js"}